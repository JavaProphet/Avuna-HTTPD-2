//
// Created by p on 4/6/19.
//

#include "huffman.h"
#include <avuna/pmem.h>
#include <stdint.h>
#include <stdlib.h>

const uint8_t bit_widths[] = {13, 23, 28, 28, 28, 28, 28, 28, 28, 24, 30, 28, 28, 30, 28, 28, 28, 28, 28, 28, 28, 28, 30, 28, 28, 28, 28, 28, 28, 28, 28, 28, 6, 10, 10, 12, 13, 6, 8, 11, 10, 10, 8, 11, 8, 6, 6, 6, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 7, 8, 15, 6, 12, 10, 13, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 7, 8, 13, 19, 13, 14, 6, 15, 5, 6, 5, 6, 5, 6, 6, 6, 5, 7, 7, 6, 6, 6, 5, 6, 7, 6, 5, 5, 6, 7, 7, 7, 7, 7, 15, 11, 14, 13, 28, 20, 22, 20, 20, 22, 22, 22, 23, 22, 23, 23, 23, 23, 23, 24, 23, 24, 24, 22, 23, 24, 23, 23, 23, 23, 21, 22, 23, 22, 23, 23, 24, 22, 21, 20, 22, 22, 23, 23, 21, 23, 22, 22, 24, 21, 22, 23, 23, 21, 21, 22, 21, 23, 22, 23, 23, 20, 22, 22, 22, 23, 22, 22, 23, 26, 26, 20, 19, 22, 23, 22, 25, 26, 26, 26, 27, 27, 26, 24, 25, 19, 21, 26, 27, 27, 26, 27, 24, 21, 21, 26, 26, 28, 27, 27, 27, 20, 24, 20, 21, 22, 21, 21, 23, 22, 22, 25, 25, 24, 24, 26, 23, 26, 27, 26, 26, 27, 27, 27, 27, 27, 28, 27, 27, 27, 27, 27, 26, 30};

inline uint16_t huffman_decode_char(uint32_t data) {
    if (data & 0b10000000000000000000000000000000) {
        if (data & 0b11000000000000000000000000000000) {
            if (data & 0b11100000000000000000000000000000) {
                if (data & 0b11110000000000000000000000000000) {
                    if (data & 0b11111000000000000000000000000000) {
                        if (data & 0b11111100000000000000000000000000) {
                            if (data & 0b11111110000000000000000000000000) {
                                if (data & 0b11111111000000000000000000000000) {
                                    if (data & 0b11111111100000000000000000000000) {
                                        if (data & 0b11111111110000000000000000000000) {
                                            if (data & 0b11111111111000000000000000000000) {
                                                if (data & 0b11111111111100000000000000000000) {
                                                    if (data & 0b11111111111110000000000000000000) {
                                                        if (data & 0b11111111111111000000000000000000) {
                                                            if (data & 0b11111111111111100000000000000000) {
                                                                if (data & 0b11111111111111110000000000000000) {
                                                                    if (data & 0b11111111111111111000000000000000) {
                                                                        if (data & 0b11111111111111111100000000000000) {
                                                                            if (data & 0b11111111111111111110000000000000) {
                                                                                if (data & 0b11111111111111111111000000000000) {
                                                                                    if (data & 0b11111111111111111111100000000000) {
                                                                                        if (data & 0b11111111111111111111110000000000) {
                                                                                            if (data & 0b11111111111111111111111000000000) {
                                                                                                if (data & 0b11111111111111111111111100000000) {
                                                                                                    if (data & 0b11111111111111111111111110000000) {
                                                                                                        if (data & 0b11111111111111111111111111000000) {
                                                                                                            if (data & 0b11111111111111111111111111100000) {
                                                                                                                if (data & 0b11111111111111111111111111110000) {
                                                                                                                    if (data & 0b11111111111111111111111111111000) {
                                                                                                                        if (data & 0b11111111111111111111111111111100) {
                                                                                                                            return 256;
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            return 22;
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else {
                                                                                                                        if (data & 0b11111111111111111111111111110100) {
                                                                                                                            return 13;
                                                                                                                        }
                                                                                                                        else {
                                                                                                                            return 10;
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 249;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111111010000) {
                                                                                                                    return 220;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 127;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111111110100000) {
                                                                                                                if (data & 0b11111111111111111111111110110000) {
                                                                                                                    return 31;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 30;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111110010000) {
                                                                                                                    return 29;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 28;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111111101000000) {
                                                                                                            if (data & 0b11111111111111111111111101100000) {
                                                                                                                if (data & 0b11111111111111111111111101110000) {
                                                                                                                    return 27;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 26;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111101010000) {
                                                                                                                    return 25;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 24;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111111100100000) {
                                                                                                                if (data & 0b11111111111111111111111100110000) {
                                                                                                                    return 23;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 21;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111100010000) {
                                                                                                                    return 20;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 19;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if (data & 0b11111111111111111111111010000000) {
                                                                                                        if (data & 0b11111111111111111111111011000000) {
                                                                                                            if (data & 0b11111111111111111111111011100000) {
                                                                                                                if (data & 0b11111111111111111111111011110000) {
                                                                                                                    return 18;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 17;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111011010000) {
                                                                                                                    return 16;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 15;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111111010100000) {
                                                                                                                if (data & 0b11111111111111111111111010110000) {
                                                                                                                    return 14;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 12;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111010010000) {
                                                                                                                    return 11;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 8;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111111001000000) {
                                                                                                            if (data & 0b11111111111111111111111001100000) {
                                                                                                                if (data & 0b11111111111111111111111001110000) {
                                                                                                                    return 7;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 6;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                if (data & 0b11111111111111111111111001010000) {
                                                                                                                    return 5;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 4;
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111111000100000) {
                                                                                                                if (data & 0b11111111111111111111111000110000) {
                                                                                                                    return 3;
                                                                                                                }
                                                                                                                else {
                                                                                                                    return 2;
                                                                                                                }
                                                                                                            }
                                                                                                            else {
                                                                                                                return 254;
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if (data & 0b11111111111111111111110100000000) {
                                                                                                    if (data & 0b11111111111111111111110110000000) {
                                                                                                        if (data & 0b11111111111111111111110111000000) {
                                                                                                            if (data & 0b11111111111111111111110111100000) {
                                                                                                                return 253;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 252;
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111110110100000) {
                                                                                                                return 251;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 250;
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111110101000000) {
                                                                                                            if (data & 0b11111111111111111111110101100000) {
                                                                                                                return 248;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 247;
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111110100100000) {
                                                                                                                return 246;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 245;
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if (data & 0b11111111111111111111110010000000) {
                                                                                                        if (data & 0b11111111111111111111110011000000) {
                                                                                                            if (data & 0b11111111111111111111110011100000) {
                                                                                                                return 244;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 241;
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111110010100000) {
                                                                                                                return 223;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 222;
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111110001000000) {
                                                                                                            if (data & 0b11111111111111111111110001100000) {
                                                                                                                return 221;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 214;
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data & 0b11111111111111111111110000100000) {
                                                                                                                return 212;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 211;
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111111101000000000) {
                                                                                                if (data & 0b11111111111111111111101100000000) {
                                                                                                    if (data & 0b11111111111111111111101110000000) {
                                                                                                        if (data & 0b11111111111111111111101111000000) {
                                                                                                            if (data & 0b11111111111111111111101111100000) {
                                                                                                                return 204;
                                                                                                            }
                                                                                                            else {
                                                                                                                return 203;
                                                                                                            }
                                                                                                        }
                                                                                                        else {
                                                                                                            return 255;
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111101101000000) {
                                                                                                            return 243;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 242;
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if (data & 0b11111111111111111111101010000000) {
                                                                                                        if (data & 0b11111111111111111111101011000000) {
                                                                                                            return 240;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 238;
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111101001000000) {
                                                                                                            return 219;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 218;
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if (data & 0b11111111111111111111100100000000) {
                                                                                                    if (data & 0b11111111111111111111100110000000) {
                                                                                                        if (data & 0b11111111111111111111100111000000) {
                                                                                                            return 213;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 210;
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111100101000000) {
                                                                                                            return 205;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 202;
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if (data & 0b11111111111111111111100010000000) {
                                                                                                        if (data & 0b11111111111111111111100011000000) {
                                                                                                            return 201;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 200;
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data & 0b11111111111111111111100001000000) {
                                                                                                            return 193;
                                                                                                        }
                                                                                                        else {
                                                                                                            return 192;
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111111010000000000) {
                                                                                            if (data & 0b11111111111111111111011000000000) {
                                                                                                if (data & 0b11111111111111111111011100000000) {
                                                                                                    if (data & 0b11111111111111111111011110000000) {
                                                                                                        return 235;
                                                                                                    }
                                                                                                    else {
                                                                                                        return 234;
                                                                                                    }
                                                                                                }
                                                                                                else {
                                                                                                    if (data & 0b11111111111111111111011010000000) {
                                                                                                        return 207;
                                                                                                    }
                                                                                                    else {
                                                                                                        return 199;
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if (data & 0b11111111111111111111010100000000) {
                                                                                                    return 237;
                                                                                                }
                                                                                                else {
                                                                                                    return 236;
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111111001000000000) {
                                                                                                if (data & 0b11111111111111111111001100000000) {
                                                                                                    return 225;
                                                                                                }
                                                                                                else {
                                                                                                    return 215;
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if (data & 0b11111111111111111111000100000000) {
                                                                                                    return 206;
                                                                                                }
                                                                                                else {
                                                                                                    return 171;
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111111110100000000000) {
                                                                                        if (data & 0b11111111111111111110110000000000) {
                                                                                            if (data & 0b11111111111111111110111000000000) {
                                                                                                if (data & 0b11111111111111111110111100000000) {
                                                                                                    return 159;
                                                                                                }
                                                                                                else {
                                                                                                    return 148;
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if (data & 0b11111111111111111110110100000000) {
                                                                                                    return 145;
                                                                                                }
                                                                                                else {
                                                                                                    return 144;
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111110101000000000) {
                                                                                                if (data & 0b11111111111111111110101100000000) {
                                                                                                    return 142;
                                                                                                }
                                                                                                else {
                                                                                                    return 9;
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                return 239;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111110010000000000) {
                                                                                            if (data & 0b11111111111111111110011000000000) {
                                                                                                return 231;
                                                                                            }
                                                                                            else {
                                                                                                return 197;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111110001000000000) {
                                                                                                return 191;
                                                                                            }
                                                                                            else {
                                                                                                return 188;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                            else {
                                                                                if (data & 0b11111111111111111101000000000000) {
                                                                                    if (data & 0b11111111111111111101100000000000) {
                                                                                        if (data & 0b11111111111111111101110000000000) {
                                                                                            if (data & 0b11111111111111111101111000000000) {
                                                                                                return 183;
                                                                                            }
                                                                                            else {
                                                                                                return 182;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111101101000000000) {
                                                                                                return 180;
                                                                                            }
                                                                                            else {
                                                                                                return 175;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111101010000000000) {
                                                                                            if (data & 0b11111111111111111101011000000000) {
                                                                                                return 174;
                                                                                            }
                                                                                            else {
                                                                                                return 168;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111101001000000000) {
                                                                                                return 166;
                                                                                            }
                                                                                            else {
                                                                                                return 165;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111111100100000000000) {
                                                                                        if (data & 0b11111111111111111100110000000000) {
                                                                                            if (data & 0b11111111111111111100111000000000) {
                                                                                                return 158;
                                                                                            }
                                                                                            else {
                                                                                                return 157;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111100101000000000) {
                                                                                                return 155;
                                                                                            }
                                                                                            else {
                                                                                                return 152;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111100010000000000) {
                                                                                            if (data & 0b11111111111111111100011000000000) {
                                                                                                return 151;
                                                                                            }
                                                                                            else {
                                                                                                return 150;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111100001000000000) {
                                                                                                return 149;
                                                                                            }
                                                                                            else {
                                                                                                return 147;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                        else {
                                                                            if (data & 0b11111111111111111010000000000000) {
                                                                                if (data & 0b11111111111111111011000000000000) {
                                                                                    if (data & 0b11111111111111111011100000000000) {
                                                                                        if (data & 0b11111111111111111011110000000000) {
                                                                                            if (data & 0b11111111111111111011111000000000) {
                                                                                                return 143;
                                                                                            }
                                                                                            else {
                                                                                                return 141;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111011101000000000) {
                                                                                                return 140;
                                                                                            }
                                                                                            else {
                                                                                                return 139;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111011010000000000) {
                                                                                            if (data & 0b11111111111111111011011000000000) {
                                                                                                return 138;
                                                                                            }
                                                                                            else {
                                                                                                return 137;
                                                                                            }
                                                                                        }
                                                                                        else {
                                                                                            if (data & 0b11111111111111111011001000000000) {
                                                                                                return 135;
                                                                                            }
                                                                                            else {
                                                                                                return 1;
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111111010100000000000) {
                                                                                        if (data & 0b11111111111111111010110000000000) {
                                                                                            return 233;
                                                                                        }
                                                                                        else {
                                                                                            return 232;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111010010000000000) {
                                                                                            return 228;
                                                                                        }
                                                                                        else {
                                                                                            return 198;
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                            else {
                                                                                if (data & 0b11111111111111111001000000000000) {
                                                                                    if (data & 0b11111111111111111001100000000000) {
                                                                                        if (data & 0b11111111111111111001110000000000) {
                                                                                            return 196;
                                                                                        }
                                                                                        else {
                                                                                            return 190;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111001010000000000) {
                                                                                            return 189;
                                                                                        }
                                                                                        else {
                                                                                            return 187;
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111111000100000000000) {
                                                                                        if (data & 0b11111111111111111000110000000000) {
                                                                                            return 186;
                                                                                        }
                                                                                        else {
                                                                                            return 185;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111111000010000000000) {
                                                                                            return 181;
                                                                                        }
                                                                                        else {
                                                                                            return 178;
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else {
                                                                        if (data & 0b11111111111111110100000000000000) {
                                                                            if (data & 0b11111111111111110110000000000000) {
                                                                                if (data & 0b11111111111111110111000000000000) {
                                                                                    if (data & 0b11111111111111110111100000000000) {
                                                                                        if (data & 0b11111111111111110111110000000000) {
                                                                                            return 173;
                                                                                        }
                                                                                        else {
                                                                                            return 170;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111110111010000000000) {
                                                                                            return 169;
                                                                                        }
                                                                                        else {
                                                                                            return 164;
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111110110100000000000) {
                                                                                        if (data & 0b11111111111111110110110000000000) {
                                                                                            return 163;
                                                                                        }
                                                                                        else {
                                                                                            return 160;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111110110010000000000) {
                                                                                            return 156;
                                                                                        }
                                                                                        else {
                                                                                            return 154;
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                            else {
                                                                                if (data & 0b11111111111111110101000000000000) {
                                                                                    if (data & 0b11111111111111110101100000000000) {
                                                                                        if (data & 0b11111111111111110101110000000000) {
                                                                                            return 146;
                                                                                        }
                                                                                        else {
                                                                                            return 136;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if (data & 0b11111111111111110101010000000000) {
                                                                                            return 134;
                                                                                        }
                                                                                        else {
                                                                                            return 133;
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111110100100000000000) {
                                                                                        if (data & 0b11111111111111110100110000000000) {
                                                                                            return 132;
                                                                                        }
                                                                                        else {
                                                                                            return 129;
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        return 230;
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                        else {
                                                                            if (data & 0b11111111111111110010000000000000) {
                                                                                if (data & 0b11111111111111110011000000000000) {
                                                                                    if (data & 0b11111111111111110011100000000000) {
                                                                                        return 229;
                                                                                    }
                                                                                    else {
                                                                                        return 227;
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111110010100000000000) {
                                                                                        return 217;
                                                                                    }
                                                                                    else {
                                                                                        return 216;
                                                                                    }
                                                                                }
                                                                            }
                                                                            else {
                                                                                if (data & 0b11111111111111110001000000000000) {
                                                                                    if (data & 0b11111111111111110001100000000000) {
                                                                                        return 209;
                                                                                    }
                                                                                    else {
                                                                                        return 179;
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111110000100000000000) {
                                                                                        return 177;
                                                                                    }
                                                                                    else {
                                                                                        return 176;
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                else {
                                                                    if (data & 0b11111111111111101000000000000000) {
                                                                        if (data & 0b11111111111111101100000000000000) {
                                                                            if (data & 0b11111111111111101110000000000000) {
                                                                                if (data & 0b11111111111111101111000000000000) {
                                                                                    if (data & 0b11111111111111101111100000000000) {
                                                                                        return 172;
                                                                                    }
                                                                                    else {
                                                                                        return 167;
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data & 0b11111111111111101110100000000000) {
                                                                                        return 161;
                                                                                    }
                                                                                    else {
                                                                                        return 153;
                                                                                    }
                                                                                }
                                                                            }
                                                                            else {
                                                                                if (data & 0b11111111111111101101000000000000) {
                                                                                    return 226;
                                                                                }
                                                                                else {
                                                                                    return 224;
                                                                                }
                                                                            }
                                                                        }
                                                                        else {
                                                                            if (data & 0b11111111111111101010000000000000) {
                                                                                if (data & 0b11111111111111101011000000000000) {
                                                                                    return 194;
                                                                                }
                                                                                else {
                                                                                    return 184;
                                                                                }
                                                                            }
                                                                            else {
                                                                                if (data & 0b11111111111111101001000000000000) {
                                                                                    return 162;
                                                                                }
                                                                                else {
                                                                                    return 131;
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else {
                                                                        if (data & 0b11111111111111100100000000000000) {
                                                                            if (data & 0b11111111111111100110000000000000) {
                                                                                if (data & 0b11111111111111100111000000000000) {
                                                                                    return 130;
                                                                                }
                                                                                else {
                                                                                    return 128;
                                                                                }
                                                                            }
                                                                            else {
                                                                                return 208;
                                                                            }
                                                                        }
                                                                        else {
                                                                            if (data & 0b11111111111111100010000000000000) {
                                                                                return 195;
                                                                            }
                                                                            else {
                                                                                return 92;
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            else {
                                                                return 123;
                                                            }
                                                        }
                                                        else {
                                                            if (data & 0b11111111111110100000000000000000) {
                                                                return 96;
                                                            }
                                                            else {
                                                                return 60;
                                                            }
                                                        }
                                                    }
                                                    else {
                                                        if (data & 0b11111111111101000000000000000000) {
                                                            return 125;
                                                        }
                                                        else {
                                                            return 94;
                                                        }
                                                    }
                                                }
                                                else {
                                                    if (data & 0b11111111111010000000000000000000) {
                                                        return 126;
                                                    }
                                                    else {
                                                        return 93;
                                                    }
                                                }
                                            }
                                            else {
                                                if (data & 0b11111111110100000000000000000000) {
                                                    if (data & 0b11111111110110000000000000000000) {
                                                        return 91;
                                                    }
                                                    else {
                                                        return 64;
                                                    }
                                                }
                                                else {
                                                    if (data & 0b11111111110010000000000000000000) {
                                                        return 36;
                                                    }
                                                    else {
                                                        return 0;
                                                    }
                                                }
                                            }
                                        }
                                        else {
                                            if (data & 0b11111111101000000000000000000000) {
                                                if (data & 0b11111111101100000000000000000000) {
                                                    return 62;
                                                }
                                                else {
                                                    return 35;
                                                }
                                            }
                                            else {
                                                return 124;
                                            }
                                        }
                                    }
                                    else {
                                        if (data & 0b11111111010000000000000000000000) {
                                            if (data & 0b11111111011000000000000000000000) {
                                                return 43;
                                            }
                                            else {
                                                return 39;
                                            }
                                        }
                                        else {
                                            return 63;
                                        }
                                    }
                                }
                                else {
                                    if (data & 0b11111110100000000000000000000000) {
                                        if (data & 0b11111110110000000000000000000000) {
                                            return 41;
                                        }
                                        else {
                                            return 40;
                                        }
                                    }
                                    else {
                                        if (data & 0b11111110010000000000000000000000) {
                                            return 34;
                                        }
                                        else {
                                            return 33;
                                        }
                                    }
                                }
                            }
                            else {
                                if (data & 0b11111101000000000000000000000000) {
                                    return 90;
                                }
                                else {
                                    return 88;
                                }
                            }
                        }
                        else {
                            if (data & 0b11111010000000000000000000000000) {
                                if (data & 0b11111011000000000000000000000000) {
                                    return 59;
                                }
                                else {
                                    return 44;
                                }
                            }
                            else {
                                if (data & 0b11111001000000000000000000000000) {
                                    return 42;
                                }
                                else {
                                    return 38;
                                }
                            }
                        }
                    }
                    else {
                        if (data & 0b11110100000000000000000000000000) {
                            if (data & 0b11110110000000000000000000000000) {
                                return 122;
                            }
                            else {
                                return 121;
                            }
                        }
                        else {
                            if (data & 0b11110010000000000000000000000000) {
                                return 120;
                            }
                            else {
                                return 119;
                            }
                        }
                    }
                }
                else {
                    if (data & 0b11101000000000000000000000000000) {
                        if (data & 0b11101100000000000000000000000000) {
                            if (data & 0b11101110000000000000000000000000) {
                                return 118;
                            }
                            else {
                                return 113;
                            }
                        }
                        else {
                            if (data & 0b11101010000000000000000000000000) {
                                return 107;
                            }
                            else {
                                return 106;
                            }
                        }
                    }
                    else {
                        if (data & 0b11100100000000000000000000000000) {
                            if (data & 0b11100110000000000000000000000000) {
                                return 89;
                            }
                            else {
                                return 87;
                            }
                        }
                        else {
                            if (data & 0b11100010000000000000000000000000) {
                                return 86;
                            }
                            else {
                                return 85;
                            }
                        }
                    }
                }
            }
            else {
                if (data & 0b11010000000000000000000000000000) {
                    if (data & 0b11011000000000000000000000000000) {
                        if (data & 0b11011100000000000000000000000000) {
                            if (data & 0b11011110000000000000000000000000) {
                                return 84;
                            }
                            else {
                                return 83;
                            }
                        }
                        else {
                            if (data & 0b11011010000000000000000000000000) {
                                return 82;
                            }
                            else {
                                return 81;
                            }
                        }
                    }
                    else {
                        if (data & 0b11010100000000000000000000000000) {
                            if (data & 0b11010110000000000000000000000000) {
                                return 80;
                            }
                            else {
                                return 79;
                            }
                        }
                        else {
                            if (data & 0b11010010000000000000000000000000) {
                                return 78;
                            }
                            else {
                                return 77;
                            }
                        }
                    }
                }
                else {
                    if (data & 0b11001000000000000000000000000000) {
                        if (data & 0b11001100000000000000000000000000) {
                            if (data & 0b11001110000000000000000000000000) {
                                return 76;
                            }
                            else {
                                return 75;
                            }
                        }
                        else {
                            if (data & 0b11001010000000000000000000000000) {
                                return 74;
                            }
                            else {
                                return 73;
                            }
                        }
                    }
                    else {
                        if (data & 0b11000100000000000000000000000000) {
                            if (data & 0b11000110000000000000000000000000) {
                                return 72;
                            }
                            else {
                                return 71;
                            }
                        }
                        else {
                            if (data & 0b11000010000000000000000000000000) {
                                return 70;
                            }
                            else {
                                return 69;
                            }
                        }
                    }
                }
            }
        }
        else {
            if (data & 0b10100000000000000000000000000000) {
                if (data & 0b10110000000000000000000000000000) {
                    if (data & 0b10111000000000000000000000000000) {
                        if (data & 0b10111100000000000000000000000000) {
                            if (data & 0b10111110000000000000000000000000) {
                                return 68;
                            }
                            else {
                                return 67;
                            }
                        }
                        else {
                            if (data & 0b10111010000000000000000000000000) {
                                return 66;
                            }
                            else {
                                return 58;
                            }
                        }
                    }
                    else {
                        if (data & 0b10110100000000000000000000000000) {
                            return 117;
                        }
                        else {
                            return 114;
                        }
                    }
                }
                else {
                    if (data & 0b10101000000000000000000000000000) {
                        if (data & 0b10101100000000000000000000000000) {
                            return 112;
                        }
                        else {
                            return 110;
                        }
                    }
                    else {
                        if (data & 0b10100100000000000000000000000000) {
                            return 109;
                        }
                        else {
                            return 108;
                        }
                    }
                }
            }
            else {
                if (data & 0b10010000000000000000000000000000) {
                    if (data & 0b10011000000000000000000000000000) {
                        if (data & 0b10011100000000000000000000000000) {
                            return 104;
                        }
                        else {
                            return 103;
                        }
                    }
                    else {
                        if (data & 0b10010100000000000000000000000000) {
                            return 102;
                        }
                        else {
                            return 100;
                        }
                    }
                }
                else {
                    if (data & 0b10001000000000000000000000000000) {
                        if (data & 0b10001100000000000000000000000000) {
                            return 98;
                        }
                        else {
                            return 95;
                        }
                    }
                    else {
                        if (data & 0b10000100000000000000000000000000) {
                            return 65;
                        }
                        else {
                            return 61;
                        }
                    }
                }
            }
        }
    }
    else {
        if (data & 0b01000000000000000000000000000000) {
            if (data & 0b01100000000000000000000000000000) {
                if (data & 0b01110000000000000000000000000000) {
                    if (data & 0b01111000000000000000000000000000) {
                        if (data & 0b01111100000000000000000000000000) {
                            return 57;
                        }
                        else {
                            return 56;
                        }
                    }
                    else {
                        if (data & 0b01110100000000000000000000000000) {
                            return 55;
                        }
                        else {
                            return 54;
                        }
                    }
                }
                else {
                    if (data & 0b01101000000000000000000000000000) {
                        if (data & 0b01101100000000000000000000000000) {
                            return 53;
                        }
                        else {
                            return 52;
                        }
                    }
                    else {
                        if (data & 0b01100100000000000000000000000000) {
                            return 51;
                        }
                        else {
                            return 47;
                        }
                    }
                }
            }
            else {
                if (data & 0b01010000000000000000000000000000) {
                    if (data & 0b01011000000000000000000000000000) {
                        if (data & 0b01011100000000000000000000000000) {
                            return 46;
                        }
                        else {
                            return 45;
                        }
                    }
                    else {
                        if (data & 0b01010100000000000000000000000000) {
                            return 37;
                        }
                        else {
                            return 32;
                        }
                    }
                }
                else {
                    if (data & 0b01001000000000000000000000000000) {
                        return 116;
                    }
                    else {
                        return 115;
                    }
                }
            }
        }
        else {
            if (data & 0b00100000000000000000000000000000) {
                if (data & 0b00110000000000000000000000000000) {
                    if (data & 0b00111000000000000000000000000000) {
                        return 111;
                    }
                    else {
                        return 105;
                    }
                }
                else {
                    if (data & 0b00101000000000000000000000000000) {
                        return 101;
                    }
                    else {
                        return 99;
                    }
                }
            }
            else {
                if (data & 0b00010000000000000000000000000000) {
                    if (data & 0b00011000000000000000000000000000) {
                        return 97;
                    }
                    else {
                        return 50;
                    }
                }
                else {
                    if (data & 0b00001000000000000000000000000000) {
                        return 49;
                    }
                    else {
                        return 48;
                    }
                }
            }
        }
    }
    return (uint16_t) -1;
}


uint8_t* huffman_decode(struct mempool* pool, uint8_t* input, size_t length, size_t* out_length) {
    size_t index = 0;
    uint8_t bit_index = 8;
    uint8_t* out = pmalloc(pool, length + 1);
    size_t out_cap = length;
    size_t out_i = 0;
    while (index < length) {
        uint32_t octet = ((uint32_t) input[index]) << (8 - bit_index + 24);
        octet |= index + 1 < length ? ((uint32_t) input[index + 1]) << 16 : 0;
        octet |= index + 2 < length ? ((uint32_t) input[index + 2]) << 8 : 0;
        octet |= index + 3 < length ? (uint32_t) input[index + 3] : 0;
        uint16_t decoded = huffman_decode_char(octet);
        if (decoded > 255) break;
        size_t bit_width = bit_widths[decoded];
        index += bit_width / 8;
        bit_index += bit_width % 8;
        if (bit_index > 8) {
            index += bit_index / 8;
            bit_index = (uint8_t) (bit_index % 8);
        }
        if (out_i >= out_cap) {
            out_cap *= 2;
            out = prealloc(pool, out_cap + 1);
        }
        out[out_i++] = (uint8_t) decoded;
    }
    out[out_i] = 0;
    *out_length = out_i;
    return out;
}